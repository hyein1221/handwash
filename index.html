<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>깨끗손 부루마블 🧼</title>
<style>
  :root {
    --line:#cddfee;
    --text:#1d2b3a;
    --p1:#79c8ff;
    --p2:#ff9ecd;
    --tile-bg:#ffffff;
    --tile-border:#cddfee;
    --special-start:#e8fff1;
    --special-goal:#fff7d9;
    --bg:#f5fbff;
    --panel-bg:#ffffff;
  }

  * { box-sizing:border-box; }

  body {
    font-family: "Pretendard", system-ui, -apple-system, BlinkMacSystemFont,
      "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px;
    gap: 12px;
  }

  h1 {
    font-size: 1.1rem;
    font-weight: 600;
    text-align: center;
    margin: 0;
    line-height:1.4;
  }

  .subtitle {
    font-size: .8rem;
    text-align:center;
    color:#4e6b86;
    line-height:1.4;
  }

  .layout {
    display:flex;
    flex-direction:column;
    gap:16px;
    width:100%;
    max-width:900px;
  }
  @media(min-width:768px){
    .layout {
      flex-direction:row;
      align-items:flex-start;
    }
  }

  /* BOARD AREA */
  .board-wrapper {
    flex:1 1 auto;
    display:flex;
    justify-content:center;
  }

  .board {
    width: min(80vw,480px);
    height: min(80vw,480px);
    background:#fff;
    border: 2px solid var(--line);
    border-radius: 16px;
    box-shadow:0 20px 40px rgba(0,0,0,.05);
    position: relative;
    display:grid;
    grid-template-columns: repeat(5,1fr);
    grid-template-rows: repeat(5,1fr);
    gap:4px;
    padding:8px;
    background: radial-gradient(circle at 50% 40%, #ffffff 0%, #e9f6ff 80%);
    font-size:10px;
  }

  /* 기본 타일 */
  .tile {
    background:var(--tile-bg);
    border:2px solid var(--tile-border);
    border-radius:10px;
    padding:4px;
    font-size:10px;
    font-weight:600;
    line-height:1.2;
    color:#1d2b3a;
    position:relative;
    display:flex;
    justify-content:center;
    align-items:center;
    text-align:center;
  }

  /* START/GOAL 칸 강조 */
  .start-tile {
    background:var(--special-start);
    border-color:#9fe1ad;
    color:#2f6f33;
  }
  .goal-tile {
    background:var(--special-goal);
    border-color:#ffd36a;
    color:#6a4a00;
  }

  /* 가운데(보드 내부)는 비워두기 */
  .empty {
    background:transparent;
    border:none;
    box-shadow:none;
    pointer-events:none;
  }

  /* 중앙 안내 텍스트(로고영역 자리) */
  .center-label{
    position:absolute;
    top:50%;
    left:50%;
    width:70%;
    max-width:240px;
    transform:translate(-50%,-50%);
    text-align:center;
    font-size:12px;
    line-height:1.4;
    background:#ffffffcc;
    border:2px solid var(--line);
    border-radius:12px;
    box-shadow:0 16px 32px rgba(0,0,0,.07);
    padding:12px;
  }
  .center-label-title{
    font-weight:600;
    font-size:14px;
    margin-bottom:4px;
    color:#1d2b3a;
  }
  .center-label-sub{
    font-size:10px;
    color:#4e6b86;
    line-height:1.4;
  }

  /* player tokens */
  .player-token {
    position:absolute;
    width:16px;
    height:16px;
    border-radius:50%;
    border:2px solid #fff;
    box-shadow:0 4px 8px rgba(0,0,0,.2);
  }
  .p1 { background:var(--p1); }
  .p2 { background:var(--p2); }

  /* small index badge (path step) */
  .idx {
    position:absolute;
    top:2px;
    left:4px;
    font-size:8px;
    line-height:1;
    opacity:.4;
    font-weight:600;
  }

  /* SIDE PANEL */
  .panel {
    flex:0 1 260px;
    background:var(--panel-bg);
    border:2px solid var(--line);
    border-radius:16px;
    box-shadow:0 20px 40px rgba(0,0,0,.05);
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:16px;
    font-size:12px;
    line-height:1.4;
  }

  .section-title {
    font-size:12px;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:6px;
    color:#234;
  }

  .row {
    display:flex;
    flex-wrap:wrap;
    align-items:center;
    gap:8px;
  }

  .value-box{
    min-width:36px;
    min-height:36px;
    border-radius:10px;
    border:2px solid var(--line);
    background:#fff;
    font-size:14px;
    font-weight:600;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  #rollBtn{
    background:#1d90ff;
    border:none;
    color:#fff;
    font-size:12px;
    font-weight:600;
    line-height:1;
    padding:10px 12px;
    border-radius:10px;
    box-shadow:0 8px 16px rgba(29,144,255,.3);
    cursor:pointer;
  }
  #rollBtn:active{
    transform:translateY(1px);
    box-shadow:0 4px 8px rgba(29,144,255,.2);
  }

  .players-status{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }

  .player-card{
    flex:1 1 110px;
    background:#f9f9fb;
    border:2px solid var(--line);
    border-radius:12px;
    padding:10px;
    line-height:1.4;
    min-width:110px;
  }
  .player-head{
    display:flex;
    align-items:center;
    gap:6px;
    font-weight:600;
    font-size:11px;
  }
  .dot{
    width:10px;
    height:10px;
    border-radius:50%;
    border:2px solid #fff;
    box-shadow:0 2px 4px rgba(0,0,0,.2);
  }
  .dot.p1{ background:var(--p1); }
  .dot.p2{ background:var(--p2); }

  .turn-indicator{
    font-size:11px;
    color:#4e6b86;
  }

  .message-box{
    background:#fffef5;
    border:2px solid #ffe9a9;
    border-radius:12px;
    padding:12px;
    font-size:11px;
    line-height:1.4;
    min-height:70px;
  }
  .message-title{
    font-weight:600;
    margin-bottom:4px;
    color:#6a4a00;
    font-size:11px;
  }
  .message-body{
    color:#4a3a00;
    white-space:pre-line;
  }

  /* MODAL POPUP (퀴즈) */
  .modal-overlay{
    position:fixed;
    left:0;top:0;right:0;bottom:0;
    background:rgba(0,0,0,.4);
    display:none;
    justify-content:center;
    align-items:center;
    padding:16px;
    z-index:999;
  }
  .modal{
    background:#fff;
    border-radius:16px;
    max-width:320px;
    width:100%;
    border:2px solid var(--line);
    box-shadow:0 24px 48px rgba(0,0,0,.25);
    padding:16px;
    font-size:14px;
    line-height:1.4;
  }
  .modal-title{
    font-size:14px;
    font-weight:600;
    margin-bottom:8px;
  }
  .modal-question{
    font-size:13px;
    line-height:1.5;
    margin-bottom:12px;
    white-space:pre-line;
  }
  .choices{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-bottom:12px;
  }
  .choice-btn{
    border:2px solid var(--line);
    border-radius:10px;
    padding:10px;
    background:#fff;
    font-size:13px;
    text-align:left;
    cursor:pointer;
  }
  .choice-btn.correct{
    border-color:#43c16b;
    background:#e8fff1;
    color:#1c5a2e;
    font-weight:600;
  }
  .choice-btn.wrong{
    border-color:#ff7d7d;
    background:#fff1f1;
    color:#7a1d1d;
    font-weight:600;
  }
  .modal-feedback{
    font-size:12px;
    line-height:1.4;
    min-height:32px;
    color:#4e6b86;
    white-space:pre-line;
    margin-bottom:12px;
  }
  .close-btn{
    width:100%;
    background:#1d90ff;
    color:#fff;
    border:none;
    font-size:13px;
    font-weight:600;
    line-height:1;
    padding:10px;
    border-radius:10px;
    cursor:pointer;
    text-align:center;
  }
  .close-btn:active{
    transform:translateY(1px);
    box-shadow:0 4px 8px rgba(29,144,255,.4);
  }

</style>
</head>
<body>
<h1>깨끗손 부루마블 🧼</h1>
<div class="subtitle">
  주사위를 굴려 한 칸씩 이동해요.<br/>
  도착한 칸의 손씻기 퀴즈에 답해볼까요?
</div>

<div class="layout">
  <!-- BOARD -->
  <div class="board-wrapper">
    <div class="board" id="board">
      <!-- 중앙 라벨(원하면 로고/이미지로 바꿔도 됨) -->
      <div class="center-label">
        <div class="center-label-title">세계 손씻기의 날</div>
        <div class="center-label-sub">
          흐르는 물에 비누로 30초 🧼<br/>
          손바닥 → 손등 → 손가락 사이 → 손톱 밑 → 엄지 → 손목
        </div>
      </div>
    </div>
  </div>

  <!-- SIDE PANEL -->
  <div class="panel">
    <div class="section-title">🎲 주사위 & 진행</div>
    <div class="row">
      <div>현재 차례:</div>
      <div class="value-box" id="currentPlayerBox">P1</div>
    </div>
    <div class="row">
      <div>주사위:</div>
      <div class="value-box" id="diceResult">-</div>
      <button id="rollBtn">주사위 굴리기</button>
    </div>

    <div class="players-status">
      <div class="player-card">
        <div class="player-head">
          <div class="dot p1"></div>
          <div>P1 (파랑)</div>
        </div>
        <div class="turn-indicator">위치: <span id="p1PosText">0</span> 칸</div>
      </div>

      <div class="player-card">
        <div class="player-head">
          <div class="dot p2"></div>
          <div>P2 (핑크)</div>
        </div>
        <div class="turn-indicator">위치: <span id="p2PosText">0</span> 칸</div>
      </div>
    </div>

    <div class="section-title">📢 현재 칸</div>
    <div class="message-box">
      <div class="message-title" id="messageTitle">게임 시작</div>
      <div class="message-body" id="messageBody">
        START 칸입니다.
        주사위를 눌러 이동해요!
      </div>
    </div>
  </div>
</div>

<!-- MODAL: 퀴즈 팝업 -->
<div class="modal-overlay" id="quizModal">
  <div class="modal">
    <div class="modal-title" id="quizTitle">퀴즈 제목</div>
    <div class="modal-question" id="quizQuestion">질문 내용</div>
    <div class="choices" id="choicesContainer"></div>
    <div class="modal-feedback" id="quizFeedback"></div>
    <button class="close-btn" id="closeQuizBtn">닫기</button>
  </div>
</div>

<script>
/* =====================
   경로 구성
   =====================

우리는 5x5 그리드(0~24 index)를 쓸 거고,
테두리만 실제 칸으로 사용해 한 바퀴 도는 구조로 갈게.

gridIndex = row*5+col

테두리 순서(시계방향):
(4,4) START -> ... -> 다시 (4,4) GOAL 느낌.
즉 START와 GOAL은 같은 칸인데
'한 바퀴 완료했는지'로 GOAL 판정.

경로:
아래줄 오른→왼, 왼쪽 위로, 위쪽 왼→오, 오른쪽 아래로 다시 출발지 근처

경로 인덱스:
(4,4)=24 START
(4,3)=23
(4,2)=22
(4,1)=21
(4,0)=20
(3,0)=15
(2,0)=10
(1,0)=5
(0,0)=0
(0,1)=1
(0,2)=2
(0,3)=3
(0,4)=4
(1,4)=9
(2,4)=14
(3,4)=19
(4,4)=24 다시 도착 → GOAL

=> 총 17스텝이지만 우리는 "중복 없이" 돌고 싶으니까
(4,4) 중복을 빼고 경로를 linear하게 만들면:
[24,23,22,21,20,15,10,5,0,1,2,3,4,9,14,19] 16칸 + 마지막에 다시 24로 돌아오면 골인.

즉: pathIndex 0~15 까지 진행 후
다음 이동으로 다시 24에 오면 GOAL.
*/

const pathOrder = [
  24,23,22,21,20,15,10,5,0,1,2,3,4,9,14,19
];
// pathOrder[0] = 24(START tile gridIndex)
// pathOrder[last] = 19, 그리고 다음 칸은 다시 24로 가면 GOAL

// 칸 타이틀(보드에 적힐 짧은 이름) + 퀴즈 데이터
// 각 path 위치별로 하나씩
const tilesData = [
  {
    label:"START",
    start:true,
    quiz:{
      title:"시작!",
      question:"깨끗한 손으로 건강 지키기 모험을 시작해요!",
      type:"info",
      choices:[],
      answerIndex:null,
      feedback:"주사위를 굴려 앞으로 가요!"
    }
  },
  {
    label:"언제 씻지?",
    quiz:{
      title:"언제 손을 씻어야 할까요?",
      question:"다음 중 손을 꼭 씻어야 하는 때는?\n1) 밥 먹기 전\n2) 장난감 보기 전",
      type:"mcq",
      choices:["밥 먹기 전","장난감 보기 전"],
      answerIndex:0,
      feedback:"식사하거나 간식 먹기 전엔 손을 깨끗하게 씻어요 🍽"
    }
  },
  {
    label:"O / X",
    quiz:{
      title:"O / X 문제",
      question:"화장실 다녀온 뒤에는 손을 씻지 않아도 된다.",
      type:"ox",
      choices:["O (맞아요)","X (아니에요)"],
      answerIndex:1,
      feedback:"화장실 다녀온 후에는 꼭 비누로 30초 손씻기! 🚽🧼"
    }
  },
  {
    label:"비누 꼭?",
    quiz:{
      title:"비누가 왜 필요할까?",
      question:"손에 묻은 세균을 잘 없애주는 것은 무엇일까요?\n1) 비누와 물\n2) 바람 쐬기",
      type:"mcq",
      choices:["비누와 물","바람 쐬기"],
      answerIndex:0,
      feedback:"흐르는 물 + 비누로 문질문질 해야 세균이 잘 떨어져요 🧼💦"
    }
  },
  {
    label:"기침했어",
    quiz:{
      title:"기침 후에는?",
      question:"내가 손으로 입을 가리고 기침했어요.\n그 다음 해야 할 일은?",
      type:"mcq",
      choices:["손씻기","아무 것도 안 하기"],
      answerIndex:0,
      feedback:"기침·콧물 뒤엔 손씻기로 감염병을 막아요 🤧➡🧼"
    }
  },
  {
    label:"코 만졌어",
    quiz:{
      title:"콧물 닦은 뒤",
      question:"콧물을 닦았을 땐?\n1) 그냥 놀이 계속하기\n2) 손을 씻기",
      type:"mcq",
      choices:["그냥 놀이 계속하기","손을 씻기"],
      answerIndex:1,
      feedback:"콧물 닦은 뒤엔 손을 깨끗하게 씻어야 해요 👃🧼"
    }
  },
  {
    label:"바깥놀이 후",
    quiz:{
      title:"놀이터 다녀온 뒤",
      question:"모래놀이, 미끄럼틀 놀이 후에는?\nO) 손씻기\nX) 그냥 간식 먹기",
      type:"ox",
      choices:["O 손씻기","X 그냥 먹기"],
      answerIndex:0,
      feedback:"바깥놀이 후엔 손을 씻고 눈·입을 만지지 않아요 🛝"
    }
  },
  {
    label:"동물 만졌어",
    quiz:{
      title:"강아지 쓰담쓰담🐶",
      question:"강아지/고양이 만진 뒤, 바로 손가락 빨아도 될까?",
      type:"mcq",
      choices:["응 괜찮아","아니, 손씻고 먹어야 해"],
      answerIndex:1,
      feedback:"동물 만진 뒤엔 꼭 손을 씻고 음식 만지기 🐶🧼"
    }
  },
  {
    label:"손가락 사이",
    quiz:{
      title:"깨끗하게 씻는 방법",
      question:"손바닥만 살짝 씻으면 될까?\n아니면 손가락 사이까지 꾹꾹 씻어야 할까?",
      type:"mcq",
      choices:["손바닥만","손가락 사이까지"],
      answerIndex:1,
      feedback:"손가락 사이, 손톱 밑까지 ‘문질문질’ 해야 깨끗해요 ✨"
    }
  },
  {
    label:"30초 기다려",
    quiz:{
      title:"얼마나 씻을까?",
      question:"손씻기는 몇 초 동안 하는 게 좋을까요?\n1) 3초\n2) 30초",
      type:"mcq",
      choices:["3초","30초"],
      answerIndex:1,
      feedback:"비누로 30초 동안 천천히 문질러요. 타이머 ‘띠링’까지! ⏱"
    }
  },
  {
    label:"비누 거품",
    quiz:{
      title:"거품의 힘",
      question:"비누 거품은 세균을 떼어내는 데 도움을 줄까요?",
      type:"ox",
      choices:["O 도움이 돼요","X 전혀 필요없어요"],
      answerIndex:0,
      feedback:"거품이 세균을 떼어내고 물이 씻어내요 🫧"
    }
  },
  {
    label:"손목까지",
    quiz:{
      title:"손 어디까지 씻어요?",
      question:"손가락만 씻으면 될까요?\n아니면 손목까지 씻어야 할까요?",
      type:"mcq",
      choices:["손가락만","손목까지 싹싹"],
      answerIndex:1,
      feedback:"손목까지 돌려 씻어주면 더 깨끗해요 💪🧼"
    }
  },
  {
    label:"친구랑 같이",
    quiz:{
      title:"친구와 약속",
      question:"친구에게 ‘밥 먹기 전에는 손 씻자!’ 라고 말해주는 건 좋은 걸까?",
      type:"ox",
      choices:["O 좋은 행동","X 쓸데없어"],
      answerIndex:0,
      feedback:"함께 알려주면 친구도 건강해져요 👫"
    }
  },
  {
    label:"눈 비비지 않기",
    quiz:{
      title:"더러운 손으로 눈 만지면?",
      question:"놀이터에서 놀고 그대로 눈을 비비면 어떻게 될까?",
      type:"mcq",
      choices:["세균이 들어갈 수 있어요","아무 일도 안 생겨요"],
      answerIndex:0,
      feedback:"더러운 손이 눈·코·입에 닿으면 세균이 몸속으로 들어갈 수 있어요 👀"
    }
  },
  {
    label:"수건으로 꾹",
    quiz:{
      title:"손 닦을 때",
      question:"손을 다 씻은 다음에는?\n1) 바지에 슥슥\n2) 개인수건/일회용 타월로 꾹꾹",
      type:"mcq",
      choices:["바지에 슥슥","개인수건/일회용 타월"],
      answerIndex:1,
      feedback:"깨끗한 수건으로 꾹꾹 닦아요 🧻"
    }
  },
  {
    label:"거의 다 왔어",
    quiz:{
      title:"GOAL 직전!",
      question:"조금만 더 가면 깨끗손 챔피언!\n준비됐나요?",
      type:"info",
      choices:[],
      answerIndex:null,
      feedback:"마지막 한 칸만 더 가요!"
    }
  }
];

// 손씻기 6단계 안내 (GOAL 도착 시)
const finalPopup = {
  title:"축하해요! 깨끗손 챔피언 🎉",
  question:
    "손씻기 6단계 기억해볼까요?\n\n" +
    "1. 손바닥 문질문질\n" +
    "2. 손등도 쓱쓱\n" +
    "3. 손가락 사이 사이 꼼꼼하게\n" +
    "4. 손톱 밑 꾹꾹 문지르기\n" +
    "5. 엄지손가락 빙글빙글\n" +
    "6. 손목까지 싹싹\n\n" +
    "흐르는 물에 비누로 30초!",
  type:"info",
  choices:[],
  answerIndex:null,
  feedback:"너랑 함께라서 더 안전해졌어 🧼💖"
};

/* =====================
   보드 DOM 생성
   =====================*/

const boardEl = document.getElementById("board");

// 25칸 만들기 (5x5). 전부 기본적으로 empty로 깔고,
// pathOrder에 해당하는 칸만 실제 타일로 바꿈.
for(let cell=0; cell<25; cell++){
  const d=document.createElement("div");
  d.classList.add("tile","empty");
  d.dataset.gridIndex = cell; // 0~24
  boardEl.appendChild(d);
}

// pathOrder에 따라 표시
for(let step=0; step<pathOrder.length; step++){
  const gridIdx = pathOrder[step]; // 24,23,22...
  const tileEl = boardEl.querySelector(`[data-grid-index="${gridIdx}"]`);
  tileEl.classList.remove("empty");

  // START 칸 (path step 0)
  if(step===0){
    tileEl.classList.add("start-tile");
  }
  // 마지막 path step (pathOrder[pathOrder.length-1])은 GOAL로 가기 직전 칸
  if(step===pathOrder.length-1){
    tileEl.classList.add("goal-tile");
  }

  // idx badge + label
  const idxDiv=document.createElement("div");
  idxDiv.classList.add("idx");
  idxDiv.textContent = step;
  tileEl.appendChild(idxDiv);

  const labelDiv=document.createElement("div");
  labelDiv.style.fontSize="10px";
  labelDiv.style.fontWeight="600";
  labelDiv.style.textAlign="center";
  labelDiv.textContent = tilesData[step].label;
  tileEl.appendChild(labelDiv);
}

/* =====================
   게임 상태
   =====================*/
let currentPlayer = 1; // 1 or 2
let pos = {1:0, 2:0};  // path index 위치 (0~마지막)
let finished = {1:false, 2:false};
let gameOver = false;

// UI refs
const diceBox = document.getElementById("diceResult");
const rollBtn = document.getElementById("rollBtn");
const messageTitle = document.getElementById("messageTitle");
const messageBody = document.getElementById("messageBody");
const p1PosText = document.getElementById("p1PosText");
const p2PosText = document.getElementById("p2PosText");
const currentPlayerBox = document.getElementById("currentPlayerBox");

// modal refs
const quizModal = document.getElementById("quizModal");
const quizTitle = document.getElementById("quizTitle");
const quizQuestion = document.getElementById("quizQuestion");
const quizFeedback = document.getElementById("quizFeedback");
const choicesContainer = document.getElementById("choicesContainer");
const closeQuizBtn = document.getElementById("closeQuizBtn");

/* 플레이어 말 그리기 */
function renderPlayers(){
  // 이전 토큰 삭제
  document.querySelectorAll(".player-token").forEach(n=>n.remove());

  [1,2].forEach(p=>{
    const pathIdx = pos[p];
    const gridIdx = pathOrder[pathIdx];
    const tileEl = boardEl.querySelector(`[data-grid-index="${gridIdx}"]`);
    if(!tileEl) return;
    const token=document.createElement("div");
    token.classList.add("player-token", p===1?"p1":"p2");

    // 두 명 겹치면 좌우로 살짝 나눠
    if(p===1){
      token.style.bottom="4px";
      token.style.left="4px";
    } else {
      token.style.bottom="4px";
      token.style.right="4px";
    }
    tileEl.appendChild(token);
  });

  p1PosText.textContent = pos[1];
  p2PosText.textContent = pos[2];
  currentPlayerBox.textContent = currentPlayer===1?"P1":"P2";
}

/* 칸 정보 표시 + 퀴즈 모달 띄우기 */
function arriveTile(player){
  const step = pos[player];
  const tileInfo = tilesData[step];

  // 사이드 패널 현재칸 표시
  messageTitle.textContent = tileInfo.label;
  messageBody.textContent = tileInfo.quiz.feedback || tileInfo.quiz.question || "";

  // GOAL 체크:
  // GOAL은 "한 바퀴 돌아서 다시 START지점(=gridIdx 24)" 오면.
  // 우리의 path 마지막 index는 pathOrder.length-1.
  // 그 다음에 다시 START(24)로 오면 finish(true)
  // 구현: 만약 현재가 pathOrder.length-1 이고 주사위가 앞으로 가서
  // 다시 START(0) 이상 넘어갔다면 finish로 처리해야 함.
  // 간단화: 플레이어가 마지막 칸(path 마지막 index)을 지나 앞으로 더 가려고 할 때 finish.
  // => move 단계에서 처리.

  // 퀴즈 모달 띄우기
  openQuizModal(tileInfo.quiz);
}

/* 퀴즈 모달 구성 */
function openQuizModal(quiz){
  quizModal.style.display="flex";
  quizTitle.textContent = quiz.title;
  quizQuestion.textContent = quiz.question;
  quizFeedback.textContent = "";
  choicesContainer.innerHTML = "";

  // type info이면 닫기만
  if(quiz.type==="info"){
    closeQuizBtn.textContent="확인";
    return;
  }

  closeQuizBtn.textContent="닫기";

  quiz.choices.forEach((choiceText, idx)=>{
    const btn=document.createElement("button");
    btn.classList.add("choice-btn");
    btn.textContent = choiceText;
    btn.addEventListener("click",()=>{
      const correct = (idx===quiz.answerIndex);
      if(correct){
        btn.classList.add("correct");
        quizFeedback.textContent = quiz.feedback || "정답!";
      }else{
        btn.classList.add("wrong");
        quizFeedback.textContent = "다시 한번 생각해볼까?\n" + (quiz.feedback||"");
      }
    });
    choicesContainer.appendChild(btn);
  });
}

/* 최종(손씻기 6단계) 모달 */
function openFinalModal(){
  quizModal.style.display="flex";
  quizTitle.textContent = finalPopup.title;
  quizQuestion.textContent = finalPopup.question;
  quizFeedback.textContent = finalPopup.feedback;
  choicesContainer.innerHTML = "";
  closeQuizBtn.textContent="완료";
}

/* 모달 닫기 */
closeQuizBtn.addEventListener("click",()=>{
  quizModal.style.display="none";
});

/* 이동 처리 */
function movePlayer(steps){
  if(gameOver) return;

  const p=currentPlayer;
  let newPos = pos[p] + steps;

  // 아직 안 끝난 플레이어만 이동
  if(finished[p]){
    // 이미 골인했으면 그냥 차례 넘김
  } else {
    // 만약 path 끝(마지막 인덱스 15)을 넘으면 -> GOAL 도착으로 처리
    if(newPos > pathOrder.length-1){
      newPos = 0; // 다시 START 위치로 돌아온 거라고 간주
      finished[p]=true;
      pos[p]=newPos;
      renderPlayers();
      openFinalModal();
    } else {
      // 정상 이동
      pos[p]=newPos;
      renderPlayers();
      arriveTile(p);
    }
  }

  // 모두 끝났는지 체크
  if(finished[1] && finished[2]){
    gameOver=true;
  }

  // 턴 교체
  currentPlayer = (currentPlayer===1)?2:1;
  renderPlayers();
}

/* 주사위 버튼 */
const diceEl = document.getElementById("diceResult");
rollBtn.addEventListener("click",()=>{
  if(gameOver) return;
  const roll = Math.floor(Math.random()*6)+1;
  diceEl.textContent = roll;
  movePlayer(roll);
});

/* 초기 렌더 */
renderPlayers();
arriveTile(1); // 처음 안내(START)
</script>
</body>
</html>
