<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ÏÜêÏîªÍ∏∞ Í≤åÏûÑüßº</title>
<style>
  :root {
    --line:#cddfee;
    --text:#1d2b3a;
    --p1:#79c8ff;
    --p2:#ff9ecd;
    --tile-bg:#ffffff;
    --tile-border:#cddfee;
    --special-start:#e8fff1;
    --special-goal:#fff7d9;
    --bg:#f5fbff;
    --panel-bg:#ffffff;
    --accent-blue:#13506f;
    --accent-pink:#7a1d1d;
  }

  * { box-sizing:border-box; }

  body {
    font-family: "Pretendard", system-ui, -apple-system, BlinkMacSystemFont,
      "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px 16px 80px;
    gap: 12px;
  }

  h1 {
    font-size: 1.1rem;
    font-weight: 600;
    text-align: center;
    margin: 0;
    line-height:1.4;
  }

  .subtitle {
    font-size: .8rem;
    text-align:center;
    color:#4e6b86;
    line-height:1.4;
  }

  .layout {
    display:flex;
    flex-direction:column;
    gap:16px;
    width:100%;
    max-width:950px;
  }
  @media(min-width:768px){
    .layout {
      flex-direction:row;
      align-items:flex-start;
    }
  }

  /* BOARD AREA */
  .board-wrapper {
    flex:1 1 auto;
    display:flex;
    justify-content:center;
  }

  .board {
    width: min(80vw,480px);
    height: min(80vw,480px);
    background:#fff;
    border: 2px solid var(--line);
    border-radius: 16px;
    box-shadow:0 20px 40px rgba(0,0,0,.05);
    position: relative;
    display:grid;
    grid-template-columns: repeat(5,1fr);
    grid-template-rows: repeat(5,1fr);
    gap:4px;
    padding:8px;
    background: radial-gradient(circle at 50% 40%, #ffffff 0%, #e9f6ff 80%);
    font-size:10px;
  }

  /* Í∏∞Î≥∏ ÌÉÄÏùº */
  .tile {
    background:var(--tile-bg);
    border:2px solid var(--tile-border);
    border-radius:10px;
    padding:4px;
    font-size:10px;
    font-weight:600;
    line-height:1.2;
    color:#1d2b3a;
    position:relative;
    display:flex;
    justify-content:center;
    align-items:center;
    text-align:center;
  }

  /* START/GOAL Ïπ∏ Í∞ïÏ°∞ */
  .start-tile {
    background:var(--special-start);
    border-color:#9fe1ad;
    color:#2f6f33;
  }
  .goal-tile {
    background:var(--special-goal);
    border-color:#ffd36a;
    color:#6a4a00;
  }

  /* Í∞ÄÏö¥Îç∞(Î≥¥Îìú ÎÇ¥Î∂Ä)Îäî ÎπÑÏõåÎëêÍ∏∞ */
  .empty {
    background:transparent;
    border:none;
    box-shadow:none;
    pointer-events:none;
  }

  /* Ï§ëÏïô ÎùºÎ≤®: Î°úÍ≥† + ÌÉÄÏù¥ÌãÄ */
  .center-label{
    position:absolute;
    top:50%;
    left:50%;
    width:70%;
    max-width:240px;
    transform:translate(-50%,-50%);
    text-align:center;
    background:#ffffffcc;
    border:2px solid var(--line);
    border-radius:12px;
    box-shadow:0 16px 32px rgba(0,0,0,.07);
    padding:12px;
  }
  .center-logo-wrap {
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
  }
  .center-logo-wrap img {
    max-width:80px;
    height:auto;
    display:block;
  }
  .center-main-title{
    font-weight:600;
    font-size:14px;
    line-height:1.4;
    color:#1d2b3a;
  }
  .center-sub{
    font-size:10px;
    color:#4e6b86;
    line-height:1.4;
    white-space:pre-line;
  }

  /* player tokens (bigger now) */
  .player-token {
    position:absolute;
    width:28px;
    height:28px;
    border-radius:50%;
    border:3px solid #fff;
    box-shadow:0 4px 8px rgba(0,0,0,.25);
    font-size:10px;
    font-weight:700;
    color:#1d2b3a;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .p1 { background:var(--p1); }
  .p2 { background:var(--p2); }

  /* index badge on tile */
  .idx {
    position:absolute;
    top:2px;
    left:4px;
    font-size:8px;
    line-height:1;
    opacity:.4;
    font-weight:600;
  }

  .label-text {
    font-size:10px;
    font-weight:600;
    text-align:center;
    line-height:1.3;
  }

  /* SIDE PANEL */
  .panel {
    flex:0 1 280px;
    background:var(--panel-bg);
    border:2px solid var(--line);
    border-radius:16px;
    box-shadow:0 20px 40px rgba(0,0,0,.05);
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:16px;
    font-size:12px;
    line-height:1.4;
  }

  .section-title {
    font-size:12px;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:6px;
    color:#234;
  }

  .row {
    display:flex;
    flex-wrap:wrap;
    align-items:center;
    gap:8px;
  }

  /* Ï£ºÏÇ¨ÏúÑ ÏãúÍ∞ÅÏòÅÏó≠ */
  .dice-visual {
    width:40px;
    height:40px;
    border-radius:8px;
    background:#fff;
    border:2px solid var(--line);
    position:relative;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:0; /* hide text */
  }
  .die-face {
    width:24px;
    height:24px;
    position:relative;
  }
  .pip {
    width:6px;
    height:6px;
    background:#1d2b3a;
    border-radius:50%;
    position:absolute;
  }
  /* positions for pip dots (like a real die) */
  .pip.p1 { top:50%; left:50%; transform:translate(-50%,-50%); }
  .pip.p2a { top:4px; left:4px; }
  .pip.p2b { bottom:4px; right:4px; }
  .pip.p3a { top:4px; left:4px; }
  .pip.p3b { top:50%; left:50%; transform:translate(-50%,-50%); }
  .pip.p3c { bottom:4px; right:4px; }
  .pip.p4a { top:4px; left:4px; }
  .pip.p4b { top:4px; right:4px; }
  .pip.p4c { bottom:4px; left:4px; }
  .pip.p4d { bottom:4px; right:4px; }
  .pip.p5a { top:4px; left:4px; }
  .pip.p5b { top:4px; right:4px; }
  .pip.p5c { bottom:4px; left:4px; }
  .pip.p5d { bottom:4px; right:4px; }
  .pip.p5e { top:50%; left:50%; transform:translate(-50%,-50%); }
  .pip.p6a { top:4px; left:4px; }
  .pip.p6b { top:4px; right:4px; }
  .pip.p6c { top:50%; left:4px; transform:translateY(-50%); }
  .pip.p6d { top:50%; right:4px; transform:translateY(-50%); }
  .pip.p6e { bottom:4px; left:4px; }
  .pip.p6f { bottom:4px; right:4px; }

  /* roll animation (shake) */
  .rolling {
    animation: shake 0.4s infinite;
  }
  @keyframes shake {
    0%   { transform: rotate(0deg)   scale(1); }
    25%  { transform: rotate(10deg)  scale(1.05); }
    50%  { transform: rotate(0deg)   scale(1); }
    75%  { transform: rotate(-10deg) scale(1.05); }
    100% { transform: rotate(0deg)   scale(1); }
  }

  #rollBtn{
    background:#1d90ff;
    border:none;
    color:#fff;
    font-size:12px;
    font-weight:600;
    line-height:1;
    padding:10px 12px;
    border-radius:10px;
    box-shadow:0 8px 16px rgba(29,144,255,.3);
    cursor:pointer;
  }
  #rollBtn:disabled {
    opacity:.5;
    cursor:default;
  }
  #rollBtn:active{
    transform:translateY(1px);
    box-shadow:0 4px 8px rgba(29,144,255,.2);
  }

  .players-status{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }

  .player-card{
    flex:1 1 125px;
    background:#f9f9fb;
    border:2px solid var(--line);
    border-radius:12px;
    padding:10px;
    line-height:1.4;
    min-width:125px;
  }
  .player-head{
    display:flex;
    align-items:center;
    gap:6px;
    font-weight:600;
    font-size:11px;
  }
  .dot{
    width:12px;
    height:12px;
    border-radius:50%;
    border:2px solid #fff;
    box-shadow:0 2px 4px rgba(0,0,0,.2);
  }
  .dot.p1{ background:var(--p1); }
  .dot.p2{ background:var(--p2); }

  .turn-indicator{
    font-size:11px;
    color:#4e6b86;
  }

  .message-box{
    background:#fffef5;
    border:2px solid #ffe9a9;
    border-radius:12px;
    padding:12px;
    font-size:11px;
    line-height:1.4;
    min-height:70px;
  }
  .message-title{
    font-weight:600;
    margin-bottom:4px;
    color:#6a4a00;
    font-size:11px;
  }
  .message-body{
    color:#4a3a00;
    white-space:pre-line;
  }

  /* MODAL POPUP (ÌÄ¥Ï¶à) */
  .modal-overlay{
    position:fixed;
    left:0;top:0;right:0;bottom:0;
    background:rgba(0,0,0,.4);
    display:none;
    justify-content:center;
    align-items:center;
    padding:16px;
    z-index:900;
  }
  .modal{
    background:#fff;
    border-radius:16px;
    max-width:320px;
    width:100%;
    border:2px solid var(--line);
    box-shadow:0 24px 48px rgba(0,0,0,.25);
    padding:16px;
    font-size:14px;
    line-height:1.4;
    position:relative;
    z-index:901;
  }
  .modal-title{
    font-size:14px;
    font-weight:600;
    margin-bottom:8px;
  }
  .modal-question{
    font-size:13px;
    line-height:1.5;
    margin-bottom:12px;
    white-space:pre-line;
  }
  .choices{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-bottom:12px;
  }
  .choice-btn{
    border:2px solid var(--line);
    border-radius:10px;
    padding:10px;
    background:#fff;
    font-size:13px;
    text-align:left;
    cursor:pointer;
  }
  .choice-btn.correct{
    border-color:#43c16b;
    background:#e8fff1;
    color:#1c5a2e;
    font-weight:600;
  }
  .choice-btn.wrong{
    border-color:#ff7d7d;
    background:#fff1f1;
    color:#7a1d1d;
    font-weight:600;
  }
  .modal-feedback{
    font-size:12px;
    line-height:1.4;
    min-height:32px;
    color:#4e6b86;
    white-space:pre-line;
    margin-bottom:12px;
  }
  .close-btn{
    width:100%;
    background:#1d90ff;
    color:#fff;
    border:none;
    font-size:13px;
    font-weight:600;
    line-height:1;
    padding:10px;
    border-radius:10px;
    cursor:pointer;
    text-align:center;
  }
  .close-btn:active{
    transform:translateY(1px);
    box-shadow:0 4px 8px rgba(29,144,255,.4);
  }

  /* Ìè≠Ï£Ω Ïù¥ÌéôÌä∏ */
  .fireworks {
    position:fixed;
    left:0;top:0;right:0;bottom:0;
    pointer-events:none;
    overflow:hidden;
    z-index:950;
    display:none;
  }
 .burst {
  position:absolute;
  width:6px;
  height:6px;
  border-radius:50%;
  animation: pop 700ms ease-out forwards;
}
@keyframes pop {
  0%   { transform:translate(0,0) scale(1); opacity:1; }
  100% { transform:translate(var(--dx),var(--dy)) scale(0.2); opacity:0; }
}

  /* Footer info */
  .footer-info {
    margin-top:16px;
    font-size:11px;
    text-align:center;
    color:#4e6b86;
    line-height:1.5;
  }

</style>
</head>
<body>
<h1>ÏÜêÏîªÍ∏∞ Í≤åÏûÑüßº</h1>
<div class="subtitle">
  Ï£ºÏÇ¨ÏúÑÎ•º Íµ¥Î†§ ÏïûÏúºÎ°ú Ïù¥ÎèôÌï¥Ïöî.<br/>
  ÎèÑÏ∞©Ìïú Ïπ∏Ïùò ÏÜêÏîªÍ∏∞ ÌÄ¥Ï¶àÏóê ÎãµÌï¥Î≥ºÍπåÏöî?
</div>

<div class="layout">
  <!-- BOARD -->
  <div class="board-wrapper">
    <div class="board" id="board">
      <!-- Ï§ëÏïô ÎùºÎ≤® -->
      <div class="center-label">
        <div class="center-logo-wrap">
          <img src="./rogo_1.png" alt="ÏßàÎ≥ëÍ¥ÄÎ¶¨Ï≤≠ Íµ≠ÎØºÏÜåÌÜµÎã® Î°úÍ≥†" />
          <div class="center-main-title">ÏÜê ÏîªÍ∏∞ Í≤åÏûÑ</div>
          <div class="center-sub">
            ÌùêÎ•¥Îäî Î¨ºÏóê ÎπÑÎàÑÎ°ú 30Ï¥à üßº
            ÏÜêÎ∞îÎã• ‚Üí ÏÜêÎì± ‚Üí ÏÜêÍ∞ÄÎùΩ ÏÇ¨Ïù¥ </br>  ‚Üí ÏÜêÌÜ± Î∞ë ‚Üí ÏóÑÏßÄ ‚Üí ÏÜêÎ™©
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SIDE PANEL -->
  <div class="panel">
    <div class="section-title">üé≤ Ï£ºÏÇ¨ÏúÑ & ÏßÑÌñâ</div>

    <div class="row" style="align-items:flex-start;">
      <div>Ï£ºÏÇ¨ÏúÑ:</div>
      <div class="dice-visual" id="diceBox">
        <div class="die-face" id="dieFace"></div>
      </div>
      <button id="rollBtn">Ï£ºÏÇ¨ÏúÑ Íµ¥Î¶¨Í∏∞</button>
    </div>

    <div class="row">
      <div>ÌòÑÏû¨ Ï∞®Î°Ä:</div>
      <div class="dice-visual" style="width:48px;height:32px;">
        <div style="font-size:14px;font-weight:600;color:#1d2b3a;" id="currentPlayerBox">P1</div>
      </div>
    </div>

    <div class="players-status">
      <div class="player-card">
        <div class="player-head">
          <div class="dot p1"></div>
          <div>P1 (ÌååÎûë)</div>
        </div>
        <div class="turn-indicator">ÏúÑÏπò: <span id="p1PosText">0</span> Ïπ∏</div>
      </div>

      <div class="player-card">
        <div class="player-head">
          <div class="dot p2"></div>
          <div>P2 (ÌïëÌÅ¨)</div>
        </div>
        <div class="turn-indicator">ÏúÑÏπò: <span id="p2PosText">0</span> Ïπ∏</div>
      </div>
    </div>

    <div class="section-title">üì¢ ÌòÑÏû¨ Ïπ∏</div>
    <div class="message-box">
      <div class="message-title" id="messageTitle">Í≤åÏûÑ ÏãúÏûë</div>
      <div class="message-body" id="messageBody">
        START Ïπ∏ÏûÖÎãàÎã§.
        Ï£ºÏÇ¨ÏúÑÎ•º ÎàåÎü¨ Ïù¥ÎèôÌï¥Ïöî!
      </div>
    </div>
  </div>
</div>

<div class="footer-info">
  Ï†úÏûëÏûê: ÏßàÎ≥ëÍ¥ÄÎ¶¨Ï≤≠ Íµ≠ÎØºÏÜåÌÜµÎã® 9Í∏∞ ÍπÄÌòúÏù∏<br/>
  Î¨∏Ïùò: hyein_1221@hanmail.net
</div>

<!-- MODAL: ÌÄ¥Ï¶à ÌåùÏóÖ -->
<div class="modal-overlay" id="quizModal">
  <div class="modal">
    <div class="modal-title" id="quizTitle">ÌÄ¥Ï¶à Ï†úÎ™©</div>
    <div class="modal-question" id="quizQuestion">ÏßàÎ¨∏ ÎÇ¥Ïö©</div>
    <div class="choices" id="choicesContainer"></div>
    <div class="modal-feedback" id="quizFeedback"></div>
    <button class="close-btn" id="closeQuizBtn">Îã´Í∏∞</button>
  </div>
</div>

<!-- Ìè≠Ï£Ω -->
<div class="fireworks" id="fireworks"></div>

<!-- Ïù¥Îèô Ìö®Í≥ºÏùå (ÏßßÏùÄ ÌÅ¥Î¶≠ ÏÇ¨Ïö¥Îìú base64) -->
<audio id="stepSound">
  <source src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA//////////////////////////////8AAAAALGF2YQAAAA8AAAACAAACcQCA//////////////////////////////8AAAAA" type="audio/mp3">
</audio>

<script>
/* ======================================================
   Í≤ΩÎ°ú Ï†ïÏùò (Î≥¥Îìú ÌÖåÎëêÎ¶¨ Ìïú Î∞îÌÄ¥)
   ======================================================

5x5 Í∑∏Î¶¨ÎìúÏùò Ïù∏Îç±Ïä§: row*5 + col
Ïö∞Î¶¨Îäî Ïò§Î•∏Ï™Ω ÏïÑÎûò Î™®ÏÑúÎ¶¨(4,4)ÏóêÏÑú Ï∂úÎ∞úÌï¥ÏÑú
ÏãúÍ≥ÑÎ∞©Ìñ•ÏúºÎ°ú Ìïú Î∞îÌÄ¥ ÎèÑÎäî ÎäêÎÇå ÎåÄÏã†,
Ïö∞Î¶¨Í∞Ä Ï†ïÏùòÌïú ÏàúÏÑúÎåÄÎ°úÎßå Ïù¥ÎèôÌïòÎ©¥ Îèº.

pathOrder[0] = START ÏúÑÏπò gridIndex(4,4)=24
...
ÎßàÏßÄÎßâ pathOrder[15] = gridIndex(3,4)=19
Í∑∏ Îã§Ïùå Îã§Ïãú START(24)Î°ú Ïò§Î©¥ GOAL Ï≤òÎ¶¨.
*/
const pathOrder = [
  24,23,22,21,20,15,10,5,0,1,2,3,4,9,14,19
];
// Ï¥ù 16Ïπ∏. Ìïú Î∞îÌÄ¥ ÎèåÍ≥† Îã§Ïãú 24Î°ú ÎèåÏïÑÏò§Î©¥ ÏôÑÏ£º.

const tilesData = [
  {
    label:"START",
    start:true,
    quiz:{
      title:"ÏãúÏûë!",
      question:"Íπ®ÎÅóÌïú ÏÜêÏúºÎ°ú Í±¥Í∞ï ÏßÄÌÇ§Í∏∞ Î™®ÌóòÏùÑ ÏãúÏûëÌï¥Ïöî!",
      type:"info",
      choices:[],
      answerIndex:null,
      feedback:"Ï£ºÏÇ¨ÏúÑÎ•º Íµ¥Î†§ ÏïûÏúºÎ°ú Í∞ÄÏöî!"
    }
  },
  {
    label:"ÏÜêÏùÄ Ïñ∏Ï†ú ÏîªÏßÄ?",
    quiz:{
      title:"Ïñ∏Ï†ú ÏÜêÏùÑ ÏîªÏñ¥Ïïº Ìï†ÍπåÏöî?",
      question:"Îã§Ïùå Ï§ë ÏÜêÏùÑ Íº≠ ÏîªÏñ¥Ïïº ÌïòÎäî ÎïåÎäî?\n1) Î∞• Î®πÍ∏∞ Ï†Ñ\n2) Ï∂§Ï∂îÍ∏∞ Ï†Ñ",
      type:"mcq",
      choices:["Î∞• Î®πÍ∏∞ Ï†Ñ","Ïû•ÎÇúÍ∞ê Î≥¥Í∏∞ Ï†Ñ"],
      answerIndex:0,
      feedback:"ÏãùÏÇ¨ÎÇò Í∞ÑÏãù Ï†ÑÏóêÎäî ÏÜêÏùÑ Íπ®ÎÅóÌïòÍ≤å ÏîªÏñ¥Ïöî üçΩ"
    }
  },
  {
    label:"ÌôîÏû•Ïã§ Îã§ÎÖÄÏò® ÌõÑÏóêÎäî?",
    quiz:{
      title:"ÌôîÏû•Ïã§ Îã§ÎÖÄÏò® ÌõÑÏóêÎäî?",
      question:"ÌôîÏû•Ïã§ Îã§ÎÖÄÏò® Îí§ÏóêÎäî ÏÜêÏùÑ ÏîªÏßÄ ÏïäÏïÑÎèÑ ÎêúÎã§.",
      type:"ox",
      choices:["O (ÎßûÏïÑÏöî)","X (ÏïÑÎãàÏóêÏöî)"],
      answerIndex:1,
      feedback:"ÌôîÏû•Ïã§ Îã§ÎÖÄÏò® ÌõÑÏóêÎäî Íº≠ ÎπÑÎàÑÎ°ú 30Ï¥à ÏÜêÏîªÍ∏∞! üöΩüßº"
    }
  },
  {
    label:"ÎπÑÎàÑÍ∞Ä Ïôú ÌïÑÏöîÌï†Íπå?",
    quiz:{
      title:"ÎπÑÎàÑÍ∞Ä Ïôú ÌïÑÏöîÌï†Íπå?",
      question:"ÏÑ∏Í∑†ÏùÑ Ïûò ÏóÜÏï†Ï£ºÎäî Í≤ÉÏùÄ?\n1) ÎπÑÎàÑÏôÄ Î¨º\n2) Î∞îÎûå Ïê¨Í∏∞",
      type:"mcq",
      choices:["ÎπÑÎàÑÏôÄ Î¨º","Î∞îÎûå Ïê¨Í∏∞"],
      answerIndex:0,
      feedback:"ÌùêÎ•¥Îäî Î¨º + ÎπÑÎàÑÎ°ú Î¨∏ÏßàÎ¨∏Ïßà Ìï¥Ïïº ÏÑ∏Í∑†Ïù¥ Ïûò Îñ®Ïñ¥Ï†∏Ïöî üßºüí¶"
    }
  },
  {
    label:"Í∏∞Ïπ® ÌõÑÏóêÎäî?",
    quiz:{
      title:"Í∏∞Ïπ® ÌõÑÏóêÎäî?",
      question:"ÎÇ¥Í∞Ä ÏÜêÏúºÎ°ú ÏûÖÏùÑ Í∞ÄÎ¶¨Í≥† Í∏∞Ïπ®ÌñàÏñ¥Ïöî.\nÍ∑∏ Îã§Ïùå Ìï¥Ïïº Ìï† ÏùºÏùÄ?",
      type:"mcq",
      choices:["ÏÜêÏîªÍ∏∞","ÏïÑÎ¨¥ Í≤ÉÎèÑ Ïïà ÌïòÍ∏∞"],
      answerIndex:0,
      feedback:"Í∏∞Ïπ®¬∑ÏΩßÎ¨º Îí§Ïóî ÏÜêÏîªÍ∏∞Î°ú Í∞êÏóºÎ≥ëÏùÑ ÎßâÏïÑÏöî ü§ß‚û°üßº"
    }
  },
  {
    label:"ÏΩßÎ¨º Îã¶ÏùÄ ÌõÑÏóêÎäî?",
    quiz:{
      title:"ÏΩßÎ¨º Îã¶ÏùÄ ÌõÑÏóêÎäî?",
      question:"ÏΩßÎ¨ºÏùÑ Îã¶ÏïòÏùÑ Îïê?\n1) Í∑∏ÎÉ• ÎÜÄÏù¥ Í≥ÑÏÜçÌïòÍ∏∞\n2) ÏÜêÏùÑ ÏîªÍ∏∞",
      type:"mcq",
      choices:["Í∑∏ÎÉ• ÎÜÄÏù¥ Í≥ÑÏÜçÌïòÍ∏∞","ÏÜêÏùÑ ÏîªÍ∏∞"],
      answerIndex:1,
      feedback:"ÏΩßÎ¨º Îã¶ÏùÄ Îí§Ïóî ÏÜêÏùÑ Íπ®ÎÅóÌïòÍ≤å ÏîªÏñ¥Ïïº Ìï¥Ïöî üëÉüßº"
    }
  },
  {
    label:"Î∞îÍπ•ÎÜÄÏù¥ ÌõÑÏóêÎäî?",
    quiz:{
      title:"Î∞îÍπ•ÎÜÄÏù¥ ÌõÑÏóêÎäî?",
      question:"Î∞îÍπ•ÎÜÄÏù¥ ÌõÑÏóêÎäî?\nO) ÏÜêÏîªÍ∏∞\nX) Í∑∏ÎÉ• Í∞ÑÏãù Î®πÍ∏∞",
      type:"ox",
      choices:["O ÏÜêÏîªÍ∏∞","X Í∑∏ÎÉ• Î®πÍ∏∞"],
      answerIndex:0,
      feedback:"Î∞îÍπ•ÎÜÄÏù¥ ÌõÑÏóî ÏÜêÏùÑ ÏîªÍ≥† Îàà¬∑ÏûÖÏùÑ ÎßåÏßÄÏßÄ ÏïäÏïÑÏöî üõù"
    }
  },
  {
    label:"ÎèôÎ¨ºÏùÑ ÎßåÏßÑ ÌõÑÏóêÎäî?",
    quiz:{
      title:"Í∞ïÏïÑÏßÄ Ïì∞Îã¥Ïì∞Îã¥üê∂",
      question:"Í∞ïÏïÑÏßÄ/Í≥†ÏñëÏù¥ ÎßåÏßÑ Îí§, Î∞îÎ°ú ÏùåÏãùÏùÑ Î®πÏñ¥ÎèÑ Îê†Íπå?",
      type:"mcq",
      choices:["Ïùë Í¥úÏ∞ÆÏïÑ","ÏïÑÎãà, ÏÜêÏîªÍ≥† Î®πÏñ¥Ïïº Ìï¥"],
      answerIndex:1,
      feedback:"ÎèôÎ¨º ÎßåÏßÑ Îí§Ïóî Íº≠ ÏÜêÏùÑ ÏîªÍ≥† ÏùåÏãùÏùÑ ÎßåÏ†∏Ïöî üê∂üßº"
    }
  },
  {
    label:"Ïñ¥ÎñªÍ≤å ÏÜêÏùÑ ÏîªÏßÄ?",
    quiz:{
      title:"Ïñ¥ÎîîÍπåÏßÄ ÏîªÏñ¥?",
      question:"ÏÜêÎ∞îÎã•Îßå ÏÇ¥Ïßù ÏîªÏúºÎ©¥ Îê†Íπå?\nÏïÑÎãàÎ©¥ ÏÜêÍ∞ÄÎùΩ ÏÇ¨Ïù¥ÍπåÏßÄ ÍæπÍæπ ÏîªÏñ¥Ïïº Ìï†Íπå?",
      type:"mcq",
      choices:["ÏÜêÎ∞îÎã•Îßå","ÏÜêÍ∞ÄÎùΩ ÏÇ¨Ïù¥ÍπåÏßÄ"],
      answerIndex:1,
      feedback:"ÏÜêÍ∞ÄÎùΩ ÏÇ¨Ïù¥, ÏÜêÌÜ± Î∞ëÍπåÏßÄ ‚ÄòÎ¨∏ÏßàÎ¨∏Ïßà‚Äô Ìï¥Ïïº Íπ®ÎÅóÌï¥Ïöî ‚ú®"
    }
  },
  {
    label:"ÏÜêÏùÑ ÏñºÎßàÎÇò ÏîªÏñ¥ÏïºÌï†Íπå?",
    quiz:{
      title:"ÏñºÎßàÎÇò ÏîªÏùÑÍπå?",
      question:"ÏÜêÏîªÍ∏∞Îäî Î™á Ï¥à ÎèôÏïà ÌïòÎäî Í≤å Ï¢ãÏùÑÍπåÏöî?\n1) 3Ï¥à\n2) 30Ï¥à",
      type:"mcq",
      choices:["3Ï¥à","30Ï¥à"],
      answerIndex:1,
      feedback:"ÎπÑÎàÑÎ°ú 30Ï¥à ÎèôÏïà Ï≤úÏ≤úÌûà Î¨∏ÏßàÎü¨Ïöî. ÌÉÄÏù¥Î®∏ 'Îù†ÎßÅ'ÍπåÏßÄ! ‚è±"
    }
  },
  {
    label:"ÎπÑÎàÑ Í±∞Ìíà",
    quiz:{
      title:"Í±∞ÌíàÏùò Ìûò",
      question:"ÎπÑÎàÑ Í±∞ÌíàÏùÄ ÏÑ∏Í∑†ÏùÑ ÎñºÏñ¥ÎÇ¥Îäî Îç∞ ÎèÑÏõÄÏùÑ Ï§ÑÍπåÏöî?",
      type:"ox",
      choices:["O ÎèÑÏõÄÏù¥ ÎèºÏöî","X Ï†ÑÌòÄ ÌïÑÏöîÏóÜÏñ¥Ïöî"],
      answerIndex:0,
      feedback:"Í±∞ÌíàÏù¥ ÏÑ∏Í∑†ÏùÑ ÎñºÏñ¥ÎÇ¥Í≥† Î¨ºÏù¥ ÏîªÏñ¥ÎÇ¥Ïöî ü´ß"
    }
  },
  {
    label:"Ïñ¥ÎîîÍπåÏßÄ ÏîªÏñ¥ÏïºÌï†Íπå?",
    quiz:{
      title:"ÏÜê Ïñ¥ÎîîÍπåÏßÄ ÏîªÏñ¥Ïöî?",
      question:"ÏÜêÍ∞ÄÎùΩÎßå ÏîªÏúºÎ©¥ Îê†ÍπåÏöî?\nÏïÑÎãàÎ©¥ ÏÜêÎ™©ÍπåÏßÄ ÏîªÏñ¥Ïïº Ìï†ÍπåÏöî?",
      type:"mcq",
      choices:["ÏÜêÍ∞ÄÎùΩÎßå","ÏÜêÎ™©ÍπåÏßÄ ÏãπÏãπ"],
      answerIndex:1,
      feedback:"ÏÜêÎ™©ÍπåÏßÄ ÎèåÎ†§ ÏîªÏñ¥Ï£ºÎ©¥ Îçî Íπ®ÎÅóÌï¥Ïöî üí™üßº"
    }
  },
  {
    label:"ÏπúÍµ¨ÏôÄ Ìï®ÍªòÌï¥Ïöî",
    quiz:{
      title:"ÏπúÍµ¨ÏôÄ ÏïΩÏÜç",
      question:"ÏπúÍµ¨ÏóêÍ≤å 'Î∞• Î®πÍ∏∞ Ï†ÑÏóî ÏÜê ÏîªÏûê!'ÎùºÍ≥† ÎßêÌï¥Ï£ºÎäî Í±¥ Ï¢ãÏùÄ Í±∏Íπå?",
      type:"ox",
      choices:["O Ï¢ãÏùÄ ÌñâÎèô","X ÎÇòÏÅú ÌñâÎèô"],
      answerIndex:0,
      feedback:"Ìï®Íªò ÏïåÎ†§Ï£ºÎ©¥ ÏπúÍµ¨ÎèÑ Í±¥Í∞ïÌï¥Ï†∏Ïöî üë´"
    }
  },
  {
    label:"ÎààÏùÑ ÎπÑÎπÑÎ©¥?",
    quiz:{
      title:"ÎààÏùÑ ÎπÑÎπÑÎ©¥?",
      question:"ÎÜÄÏù¥ÌÑ∞ÏóêÏÑú ÎÜÄÍ≥† Í∑∏ÎåÄÎ°ú ÎààÏùÑ ÎπÑÎπÑÎ©¥ Ïñ¥ÎñªÍ≤å Îê†Íπå?",
      type:"mcq",
      choices:["ÏÑ∏Í∑†Ïù¥ Îì§Ïñ¥Í∞à Ïàò ÏûàÏñ¥Ïöî","ÏïÑÎ¨¥ ÏùºÎèÑ Ïïà ÏÉùÍ≤®Ïöî"],
      answerIndex:0,
      feedback:"ÎçîÎü¨Ïö¥ ÏÜêÏù¥ Îàà¬∑ÏΩî¬∑ÏûÖÏóê ÎãøÏúºÎ©¥ ÏÑ∏Í∑†Ïù¥ Î™∏ÏÜçÏúºÎ°ú Îì§Ïñ¥Í∞à Ïàò ÏûàÏñ¥Ïöî üëÄ"
    }
  },
  {
    label:"ÏÜêÏùÑ ÏîªÏùÄ ÌõÑÏóêÎäî?",
    quiz:{
      title:"ÏÜê Îã¶ÏùÑ Îïå",
      question:"ÏÜêÏùÑ Îã§ ÏîªÏùÄ Îã§ÏùåÏóêÎäî?\n1) Î∞îÏßÄÏóê Ïä•Ïä•\n2) Í∞úÏù∏ÏàòÍ±¥/ÏùºÌöåÏö© ÌÉÄÏõîÎ°ú ÍæπÍæπ",
      type:"mcq",
      choices:["Î∞îÏßÄÏóê Ïä•Ïä•","Í∞úÏù∏ÏàòÍ±¥/ÏùºÌöåÏö© ÌÉÄÏõî"],
      answerIndex:1,
      feedback:"Íπ®ÎÅóÌïú ÏàòÍ±¥ÏúºÎ°ú ÍæπÍæπ Îã¶ÏïÑÏöî üßª"
    }
  },
  {
    label:"Ï°∞Í∏àÎßå Îçî ÌûòÎÇ¥!",
    quiz:{
      title:"GOAL ÏßÅÏ†Ñ!",
      question:"Ï°∞Í∏àÎßå Îçî Í∞ÄÎ©¥ Íπ®ÎÅóÏÜê Ï±îÌîºÏñ∏!\nÏ§ÄÎπÑÎêêÎÇòÏöî?",
      type:"info",
      choices:[],
      answerIndex:null,
      feedback:"ÎßàÏßÄÎßâ Ìïú Ïπ∏Îßå Îçî Í∞ÄÏöî!"
    }
  }
];

const finalPopup = {
  title:"Ï∂ïÌïòÌï¥Ïöî! ÏÜêÏîªÍ∏∞ Ï±îÌîºÏñ∏ üéâ",
  question:
    "ÏÜêÏîªÍ∏∞ 6Îã®Í≥Ñ Í∏∞ÏñµÌï¥Î≥ºÍπåÏöî?\n\n" +
    "1. ÏÜêÎ∞îÎã• Î¨∏ÏßàÎ¨∏Ïßà\n" +
    "2. ÏÜêÎì±ÎèÑ Ïì±Ïì±\n" +
    "3. ÏÜêÍ∞ÄÎùΩ ÏÇ¨Ïù¥ ÏÇ¨Ïù¥ ÍººÍººÌïòÍ≤å\n" +
    "4. ÏÜêÌÜ± Î∞ë ÍæπÍæπ Î¨∏ÏßÄÎ•¥Í∏∞\n" +
    "5. ÏóÑÏßÄÏÜêÍ∞ÄÎùΩ ÎπôÍ∏ÄÎπôÍ∏Ä\n" +
    "6. ÏÜêÎ™©ÍπåÏßÄ ÏãπÏãπ\n\n" +
    "ÌùêÎ•¥Îäî Î¨ºÏóê ÎπÑÎàÑÎ°ú 30Ï¥à!" +
    "10Ïõî 15Ïùº ÏÑ∏Í≥Ñ ÏÜêÏîªÍ∏∞Ïùò ÎÇ† Í∏∞ÏñµÌï¥Ï§ò!" ,
  type:"info",
  choices:[],
  answerIndex:null,
  feedback:"ÏπúÍµ¨ÏôÄ Ìï®ÍªòÎùºÏÑú ÎçîÏö± Íπ®ÎÅóÌïòÍ≥† ÏïàÏ†ÑÌï¥Ï°åÏñ¥!üßºüíñ"
};

/* ======================================================
   Î≥¥Îìú DOM ÎßåÎì§Í∏∞
   ====================================================== */
const boardEl = document.getElementById("board");

// 25Ïπ∏(5x5) Í∏∞Î≥∏ emptyÎ°ú ÍπîÍ≥†
for(let cell=0; cell<25; cell++){
  const d=document.createElement("div");
  d.classList.add("tile","empty");
  d.dataset.gridIndex = cell; // 0~24
  boardEl.appendChild(d);
}

// pathOrderÏóê Ïã§Ï†ú Ïπ∏ Ï±ÑÏö∞Í∏∞ + START/GOAL Ïä§ÌÉÄÏùº
for(let step=0; step<pathOrder.length; step++){
  const gridIdx = pathOrder[step];
  const tileEl = boardEl.querySelector(`[data-grid-index="${gridIdx}"]`);
  tileEl.classList.remove("empty");
  if(step===0){
    tileEl.classList.add("start-tile");
  }
  if(step===pathOrder.length-1){
    tileEl.classList.add("goal-tile");
  }
  const idxDiv=document.createElement("div");
  idxDiv.classList.add("idx");
  idxDiv.textContent = step;
  tileEl.appendChild(idxDiv);

  const labelDiv=document.createElement("div");
  labelDiv.classList.add("label-text");
  labelDiv.textContent = tilesData[step].label;
  tileEl.appendChild(labelDiv);
}

/* ======================================================
   Í≤åÏûÑ ÏÉÅÌÉú
   ====================================================== */
let currentPlayer = 1; // 1 or 2
let pos = {1:0, 2:0};  // path index ÏúÑÏπò (0~15)
let finished = {1:false, 2:false};
let gameOver = false;
let rolling = false;

const dieFaceEl = document.getElementById("dieFace");
const rollBtn = document.getElementById("rollBtn");
const currentPlayerBox = document.getElementById("currentPlayerBox");

const p1PosText = document.getElementById("p1PosText");
const p2PosText = document.getElementById("p2PosText");

const messageTitle = document.getElementById("messageTitle");
const messageBody = document.getElementById("messageBody");

const quizModal = document.getElementById("quizModal");
const quizTitle = document.getElementById("quizTitle");
const quizQuestion = document.getElementById("quizQuestion");
const quizFeedback = document.getElementById("quizFeedback");
const choicesContainer = document.getElementById("choicesContainer");
const closeQuizBtn = document.getElementById("closeQuizBtn");

const fireworksEl = document.getElementById("fireworks");
const stepSound = document.getElementById("stepSound");

/* ======================================================
   Ï£ºÏÇ¨ÏúÑ Í∑∏Î¶¨Í∏∞
   ====================================================== */
function renderDieFace(n){
  // n:1~6
  // dieFaceEl ÏïàÏóê pip DOM Îã§Ïãú ÎÑ£Í∏∞
  dieFaceEl.innerHTML = "";
  const face = document.createElement("div");
  face.className = "die-face";
  if(n===1){
    face.innerHTML = `<div class="pip p1"></div>`;
  }else if(n===2){
    face.innerHTML = `<div class="pip p2a"></div><div class="pip p2b"></div>`;
  }else if(n===3){
    face.innerHTML = `<div class="pip p3a"></div><div class="pip p3b"></div><div class="pip p3c"></div>`;
  }else if(n===4){
    face.innerHTML = `<div class="pip p4a"></div><div class="pip p4b"></div><div class="pip p4c"></div><div class="pip p4d"></div>`;
  }else if(n===5){
    face.innerHTML = `<div class="pip p5a"></div><div class="pip p5b"></div><div class="pip p5c"></div><div class="pip p5d"></div><div class="pip p5e"></div>`;
  }else if(n===6){
    face.innerHTML = `<div class="pip p6a"></div><div class="pip p6b"></div><div class="pip p6c"></div><div class="pip p6d"></div><div class="pip p6e"></div><div class="pip p6f"></div>`;
  }
  dieFaceEl.appendChild(face);
}

/* ======================================================
   ÌîåÎ†àÏù¥Ïñ¥ Îßê Î†åÎçîÎßÅ
   ====================================================== */
function renderPlayers(){
  // Í∏∞Ï°¥ ÌÜ†ÌÅ∞ Ï†úÍ±∞
  document.querySelectorAll(".player-token").forEach(n=>n.remove());

  [1,2].forEach(p=>{
    const pathIdx = pos[p];
    const gridIdx = pathOrder[pathIdx];
    const tileEl = boardEl.querySelector(`[data-grid-index="${gridIdx}"]`);
    if(!tileEl) return;
    const token=document.createElement("div");
    token.classList.add("player-token", p===1?"p1":"p2");

    if(p===1){
      token.style.bottom="4px";
      token.style.left="4px";
      token.textContent="1";
    } else {
      token.style.top="4px";
      token.style.right="4px";
      token.textContent="2";
    }

    tileEl.appendChild(token);
  });

  p1PosText.textContent = pos[1];
  p2PosText.textContent = pos[2];
  currentPlayerBox.textContent = currentPlayer===1?"P1":"P2";
}

/* ======================================================
   Ìè≠Ï£Ω Ïù¥ÌéôÌä∏
   ====================================================== */
function makeFireworkBurst(x, y) {
  // Îçî ÌÅ¨Í≤å Ìå°! ÌÑ∞Îú®Î¶¨Í∏∞
  const particleCount = 28; // Í∏∞Ï°¥ 12 ‚Üí 28
  for (let i = 0; i < particleCount; i++) {
    const dot = document.createElement("div");
    dot.className = "burst";

    // Ï°∞Í∞Å(Ïª®ÌéòÌã∞) Ï°∞Í∏à Îçî ÌÅ¨Í≤å
    dot.style.width = "10px";
    dot.style.height = "10px";
    dot.style.borderRadius = "3px"; // ÏÇ¥Ïßù ÎÑ§Î™® ÎäêÎÇå Ï£ºÎ©¥ ÏßÑÏßú Ïª®ÌéòÌã∞ Í∞ôÏù¥ Î≥¥Ïó¨

    // Í∞ÅÎèÑ ÎûúÎç§
    const angle = Math.random() * Math.PI * 2;

    // Ìõ®Ïî¨ Î©ÄÎ¶¨ ÎÇ†ÏïÑÍ∞ÄÍ≤å (ÏõêÎûò 60~90px Ï†ïÎèÑÏòÄÏùå)
    const dist = 120 + Math.random() * 80; // 120~200px

    const dx = Math.cos(angle) * dist;
    const dy = Math.sin(angle) * dist;

    dot.style.left = x + "px";
    dot.style.top = y + "px";
    dot.style.setProperty("--dx", dx + "px");
    dot.style.setProperty("--dy", dy + "px");

    // ÏÉâ Îçî ÌäÄÍ≤å (HSL ‚Üí ÎÜíÏùÄ Ï±ÑÎèÑ)
    dot.style.background = `hsl(${Math.floor(Math.random()*360)},90%,60%)`;

    fireworksEl.appendChild(dot);

    // ÏûêÎèô Ï†úÍ±∞
    setTimeout(() => dot.remove(), 800);
  }
}

function firework() {
  fireworksEl.style.display = "block";
  const { innerWidth: w, innerHeight: h } = window;

  // Í∞ÄÏö¥Îç∞ + ÏñëÏòÜ + ÏúÑÏ™ΩÎèÑ Ìå°Ìå°
  makeFireworkBurst(w * 0.5, h * 0.3);
  makeFireworkBurst(w * 0.3, h * 0.35);
  makeFireworkBurst(w * 0.7, h * 0.35);
  makeFireworkBurst(w * 0.4, h * 0.2);
  makeFireworkBurst(w * 0.6, h * 0.2);

  // ÌôîÎ©¥ÏùÑ ÏïΩÍ∞Ñ Îçî Ïò§Îûò Ïú†ÏßÄÌï¥ÏÑú Ïï†Îì§Ïù¥ ÌôïÏù∏Ìï† ÏãúÍ∞Ñ Ï£ºÍ∏∞
  setTimeout(() => {
    fireworksEl.style.display = "none";
  }, 1000);
}


/* ======================================================
   ÌÄ¥Ï¶à Î™®Îã¨
   ====================================================== */
function openQuizModal(quiz, celebrate){
  quizModal.style.display="flex";
  quizTitle.textContent = quiz.title;
  quizQuestion.textContent = quiz.question;
  quizFeedback.textContent = "";
  choicesContainer.innerHTML = "";

  // Ï∂ïÌïò ÌîåÎûòÍ∑∏(Ï†ïÎãµ ÎßûÏúºÎ©¥ Ìè≠Ï£Ω) Ï¥àÍ∏∞Ìôî
  let answered = false;

  if(quiz.type==="info"){
    closeQuizBtn.textContent="ÌôïÏù∏";
  }else{
    closeQuizBtn.textContent="Îã´Í∏∞";
  }

  quiz.choices.forEach((choiceText, idx)=>{
    const btn=document.createElement("button");
    btn.classList.add("choice-btn");
    btn.textContent = choiceText;

    btn.addEventListener("click",()=>{
      if(answered) return;
      answered=true;
      const correct = (idx===quiz.answerIndex);
      if(correct){
        btn.classList.add("correct");
        quizFeedback.textContent = quiz.feedback || "Ï†ïÎãµ!";
        // Ï∂ïÌïò Ìè≠Ï£Ω
        firework();
      }else{
        btn.classList.add("wrong");
        quizFeedback.textContent = "Îã§Ïãú ÏÉùÍ∞ÅÌï¥Î≥ºÍπå?\n" + (quiz.feedback||"");
      }
    });

    choicesContainer.appendChild(btn);
  });

  // info ÌÉÄÏûÖÏùº Í≤ΩÏö∞ÏóêÎèÑ ÏôÑÏ£ºÎÇò ÌäπÎ≥Ñ ÏÉÅÌô©ÏóêÎäî Ìè≠Ï£Ω Í∞ÄÎä•
  if(quiz.type==="info" && celebrate){
    firework();
  }
}

function openFinalModal(){
  quizModal.style.display="flex";
  quizTitle.textContent = finalPopup.title;
  quizQuestion.textContent = finalPopup.question;
  quizFeedback.textContent = finalPopup.feedback;
  choicesContainer.innerHTML = "";
  closeQuizBtn.textContent="ÏôÑÎ£å";
  firework();
}

/* Îã´Í∏∞ Î≤ÑÌäº */
closeQuizBtn.addEventListener("click",()=>{
  quizModal.style.display="none";
});

/* Ïπ∏ ÎèÑÏ∞© ÌõÑ Ï≤òÎ¶¨ */
function arriveTile(player){
  const step = pos[player];
  const tileInfo = tilesData[step];

  // ÏÇ¨Ïù¥Îìú Ìå®ÎÑê Î©îÏãúÏßÄ Í∞±Ïã†
  messageTitle.textContent = tileInfo.label;
  messageBody.textContent = tileInfo.quiz.feedback || tileInfo.quiz.question || "";

  // ÌÄ¥Ï¶à Î™®Îã¨ ÎùÑÏö∞Í∏∞
  openQuizModal(tileInfo.quiz, false);
}

/* ======================================================
   Ïù¥Îèô Ïï†ÎãàÎ©îÏù¥ÏÖò (Ìïú Ïπ∏Ïî© Îî±Îî±Îî± Ïù¥Îèô)
   ====================================================== */
function animateMove(player, steps, onDone){
  // stepsÎßåÌÅº 1Ïπ∏Ïî© Ïù¥Îèô
  // ÎßàÏßÄÎßâ ÎèÑÏ∞© ÌõÑ arriveTile Ìò∏Ï∂ú
  if(steps<=0){
    // ÏïÑÎ¨¥ Ïù¥ÎèôÎèÑ ÏóÜÏúºÎ©¥ Í∑∏ÎÉ• ÎèÑÏ∞© Ï≤òÎ¶¨
    arriveTile(player);
    if(onDone) onDone();
    return;
  }

  let moved = 0;

  function stepOnce(){
    if(moved>=steps){
      // Îã§ Ïù¥Îèô ÎÅù!
      // ÎèÑÏ∞©Ìïú Ïπ∏ ÌôïÏù∏
      arriveTile(player);
      if(onDone) onDone();
      return;
    }

    // Îã§Ïùå Ïπ∏ÏúºÎ°ú Ïã§Ï†ú 1Ïπ∏ Ïù¥Îèô
    pos[player]++;

    // path ÎßàÏßÄÎßâÏùÑ ÎÑòÎäî Í≤ΩÏö∞ -> Ìïú Î∞îÌÄ¥ ÎèåÍ≥† Îã§Ïãú START(=finish)
    if(pos[player] > pathOrder.length-1){
      pos[player] = 0;
      finished[player]=true;
      renderPlayers();
      openFinalModal(); // ÏÜêÏîªÍ∏∞ 6Îã®Í≥Ñ ÏïàÎÇ¥ + Ìè≠Ï£Ω
      if(onDone) onDone();
      return;
    }

    renderPlayers();
    // Ïù¥ÎèôÎßàÎã§ Ìö®Í≥ºÏùå
    try {
      stepSound.currentTime = 0;
      stepSound.play().catch(()=>{});
    } catch(e){}

    moved++;
    setTimeout(stepOnce, 250); // Ìïú Ïπ∏ Ïù¥Îèô ÌÖúÌè¨
  }

  stepOnce();
}

/* ======================================================
   Ï£ºÏÇ¨ÏúÑ Íµ¥Î¶¨Í∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò + Ïù¥Îèô Ï≤òÎ¶¨
   ====================================================== */
function rollDiceAndMove(){
  if(gameOver || rolling) return;
  rolling = true;
  rollBtn.disabled = true;

  // Íµ¥Î¶¨Îäî ÎèôÏïà ÎûúÎç§ Ïà´Ïûê ÌùîÎì§Í∏∞
  const startTime = Date.now();
  const rollDuration = 1000; // 1Ï¥à Ï†ïÎèÑ Íµ¥Î¶¨Îäî ÎäêÎÇå
  const diceBox = document.getElementById("diceBox");
  diceBox.classList.add("rolling");

  function animFrame(){
    const elapsed = Date.now()-startTime;
    const tempVal = Math.floor(Math.random()*6)+1;
    renderDieFace(tempVal);

    if(elapsed < rollDuration){
      requestAnimationFrame(animFrame);
    }else{
      // ÏµúÏ¢Ö Í∞í ÌôïÏ†ï
      const finalVal = Math.floor(Math.random()*6)+1;
      renderDieFace(finalVal);
      diceBox.classList.remove("rolling");

      // Ïù¥Ï†ú Ïù¥Îèô Ïï†ÎãàÎ©îÏù¥ÏÖò
      const thisPlayer = currentPlayer;
      animateMove(thisPlayer, finalVal, ()=>{
        // Ïù¥Îèô ÌõÑ ÌÑ¥ ÎÑòÍ∏∞Í∏∞ / Í≤åÏûÑÏ¢ÖÎ£å ÌôïÏù∏
        if(finished[1] && finished[2]){
          gameOver=true;
        }
        // ÌÑ¥ Î≥ÄÍ≤Ω
        currentPlayer = (currentPlayer===1)?2:1;
        renderPlayers();
        rollBtn.disabled = false;
        rolling = false;
      });
    }
  }
  animFrame();
}

/* ======================================================
   Ï¥àÍ∏∞ ÏÉÅÌÉú ÏÑ∏ÌåÖ
   ====================================================== */
renderDieFace(1);
renderPlayers();
// STARTÏπ∏ ÏïàÎÇ¥Î•º Ï≤´ ÌôîÎ©¥Ïóê Î∞îÎ°ú Î≥¥Ïó¨Ï£ºÍ≥† Ïã∂ÏúºÎ©¥:
(function initMessage(){
  const step = pos[1]; // p1 ÌòÑÏû¨ step (0)
  const tileInfo = tilesData[step];
  messageTitle.textContent = tileInfo.label;
  messageBody.textContent = tileInfo.quiz.feedback || tileInfo.quiz.question || "";
})();

/* Î≤ÑÌäº Ïù¥Î≤§Ìä∏ */
rollBtn.addEventListener("click", rollDiceAndMove);

</script>
</body>
</html>

